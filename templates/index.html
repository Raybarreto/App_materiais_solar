<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Lista de Materiais - Sol Ã  Vista</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  </head>
  <body>
    <header>
      <h2>Lista de Materiais - Sol Ã  Vista Energia Solar</h2>
      <a href="{{ url_for('history') }}">HistÃ³rico</a>
    </header>

Â  Â  <main>
Â  Â  Â  <form method="post" action="{{ url_for('create') }}">
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <label>Nome do Cliente: <input required name="client"></label>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <label>ResponsÃ¡vel tÃ©cnico: <input required name="technician"></label>
Â  Â  Â  Â  </div>
          <input type="hidden" name="count" id="material-count" value="0">
Â  Â  Â  Â  <hr>

Â  Â  Â  Â  <h3>Adicionar Material</h3>
Â  Â  Â  Â  <label for="categoria">Categoria:</label>
Â  Â  Â  Â  <select id="categoria" onchange="carregarMateriais()">
Â  Â  Â  Â  Â  <option value="">Selecione...</option>
Â  Â  Â  Â  Â  {% for categoria in materials.keys() %}
Â  Â  Â  Â  Â  <option value="{{ categoria }}">{{ categoria }}</option>
Â  Â  Â  Â  Â  {% endfor %}
Â  Â  Â  Â  </select>

Â  Â  Â  Â  <label for="material">Material:</label>
Â  Â  Â  Â  <select id="material">
Â  Â  Â  Â  Â  <option value="">Selecione uma categoria</option>
Â  Â  Â  Â  </select>
        
        <label for="unidade">Unidade:</label> 
        <input type="text" id="unidade" placeholder="un/m/par" value="un">

Â  Â  Â  Â  <label for="quantidade">Quantidade:</label>
Â  Â  Â  Â  <input type="number" id="quantidade" min="0" value="0">

Â  Â  Â  Â  <button type="button" onclick="adicionarMaterial()">Adicionar</button>

Â  Â  Â  Â  <ul id="lista-materiais"></ul>

Â  Â  Â  Â  <h4>Adicionar Novo Material</h4>
Â  Â  Â  Â  <div id="new-material-section">
Â  Â  Â  Â  Â  <label>DescriÃ§Ã£o: <input type="text" id="new_name" placeholder="Ex: Cabo 10mmÂ²"></label>
Â  Â  Â  Â  Â  <label>Unidade: <input type="text" id="new_unit" placeholder="Ex: m / un / par" style="width:60px"></label>
          <label>Qtd: <input type="number" id="new_qty" min="1" value="1" style="width:60px"></label>

Â  Â  Â  Â  Â  <button type="button" onclick="addMaterial()">Adicionar</button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div style="margin-top:20px;">
Â  Â  Â  Â  Â  <button type="submit">Gerar PDF e Salvar</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </form>

Â  Â  Â  <p style="margin-top:20px;">ðŸ’¡ ApÃ³s gerar o PDF, baixe o arquivo e envie pelo WhatsApp Web, Desktop ou app do celular.</p>
Â  Â  </main>

Â  Â  <footer>
Â  Â  Â  Â© 2025 Sol Ã  Vista Energia Solar â€” Desenvolvido por Raylaine Barreto. Todos os direitos reservados.
Â  Â  </footer>

Â  Â  <script>
Â  Â  Â  const materials = {{materials|tojson }};
Â  Â  Â  let materialIndex = 0;
Â  Â  Â  const form = document.querySelector("form");
Â  Â  Â  const materialCountInput = document.getElementById("material-count");

Â  Â  Â  function carregarMateriais() {
Â  Â  Â  Â  const categoria = document.getElementById("categoria").value;
Â  Â  Â  Â  const materialSelect = document.getElementById("material");
Â  Â  Â  Â  materialSelect.innerHTML = "";

Â  Â  Â  Â  if (categoria && materials[categoria]) {
Â  Â  Â  Â  Â  materials[categoria].forEach(mat => {
Â  Â  Â  Â  Â  Â  const option = document.createElement("option");
Â  Â  Â  Â  Â  Â  option.value = mat;
Â  Â  Â  Â  Â  Â  option.text = mat;
Â  Â  Â  Â  Â  Â  materialSelect.add(option);
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  const option = document.createElement("option");
Â  Â  Â  Â  Â  option.text = "Selecione uma categoria";
Â  Â  Â  Â  Â  materialSelect.add(option);
Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â  function adicionarMaterial() {
Â  Â  Â  Â  const material = document.getElementById("material").value;
        const unidade = document.getElementById("unidade").value.trim();
Â  Â  Â  Â  const quantidade = document.getElementById("quantidade").value;

        if (material && parseInt(quantidade) > 0 && unidade) { 
Â  Â  Â  Â  Â  const lista = document.getElementById("lista-materiais");
Â  Â  Â  Â  Â  const li = document.createElement("li");
Â  Â  Â  Â  Â  li.textContent = `${material} â€” ${quantidade} ${unidade}`; 
Â  Â  Â  Â  Â  lista.appendChild(li);
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  form.insertAdjacentHTML("beforeend", `
            <input type="hidden" name="code_${materialIndex}" value="${material.substring(0, 10)}"> 
Â  Â  Â  Â  Â  Â  <input type="hidden" name="name_${materialIndex}" value="${material}">
Â  Â  Â  Â  Â  Â  <input type="hidden" name="unit_${materialIndex}" value="${unidade}">
Â  Â  Â  Â  Â  Â  <input type="hidden" name="qty_${materialIndex}" value="${quantidade}">
Â  Â  Â  Â  Â  `);

Â  Â  Â  Â  Â  materialIndex++;
Â  Â  Â  Â  Â  materialCountInput.value = materialIndex;
Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â  function addMaterial() {
Â  Â  Â  Â  const name = document.getElementById("new_name").value.trim();
Â  Â  Â  Â  const unit = document.getElementById("new_unit").value.trim();
        const qty = document.getElementById("new_qty").value;
Â  Â  Â  Â  const tempCode = name.substring(0, 10).toUpperCase(); 

Â  Â  Â  Â  if (!name || !unit || parseInt(qty) <= 0) {
Â  Â  Â  Â  Â  alert("Preencha a DescriÃ§Ã£o e a Unidade antes de adicionar o material!");
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const container = document.createElement("div");
Â  Â  Â  Â  container.classList.add("material");
Â  Â  Â  Â  const uniqueId = Date.now();
Â  Â  Â  Â  
Â  Â  Â  Â  container.innerHTML = `
Â  Â  Â  Â  Â  <div style="width:200px">(${tempCode}) â€” ${name}</div>
          <div style="width:100px">${qty} ${unit}</div> 
Â  Â  Â  Â  Â  <div>
            <input type="hidden" name="qty_extra_${uniqueId}" value="${qty}">
Â  Â  Â  Â  Â  Â  <input type="hidden" name="code_extra_${uniqueId}" value="${tempCode}"> 
Â  Â  Â  Â  Â  Â  <input type="hidden" name="name_extra_${uniqueId}" value="${name}">
Â  Â  Â  Â  Â  Â  <input type="hidden" name="unit_extra_${uniqueId}" value="${unit}">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  Â  const button = document.querySelector('button[type="submit"]');
Â  Â  Â  Â  button.parentElement.parentElement.insertBefore(container, button.parentElement);

Â  Â  Â  Â  document.getElementById("new_name").value = "";
Â  Â  Â  Â  document.getElementById("new_unit").value = "";
Â  Â  Â  Â  document.getElementById("new_qty").value = "1";
Â  Â  Â  }
Â  Â  </script>
Â  </body>
</html>
